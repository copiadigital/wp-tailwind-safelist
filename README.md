# WP Tailwind Safelist

Automatically creates a Tailwind CSS safelist from WordPress content including Gutenberg blocks, ACF fields (flexible content, repeaters, groups), Contact Form 7 forms, and more.

Built for [Sage](https://roots.io/sage) themes using [Acorn](https://roots.io/acorn).

## Requirements

- PHP >= 8.1
- [Acorn](https://roots.io/acorn) >= 4.0
- [Sage](https://roots.io/sage) >= 10.0

## Installation

Add the repository to your theme's `composer.json`:

```json
{
  "repositories": {
    "wp-tailwind-safelist": {
      "type": "vcs",
      "url": "git@github.com:copiadigital/wp-tailwind-safelist.git"
    }
  }
}
```

Install via Composer:

```bash
composer require copiadigital/wp-tailwind-safelist
```

## Setup

### 1. Register the service provider so commands are available:

```bash
wp acorn package:discover
```

### 2. Create the database table

```bash
wp acorn tailwind:update-db
```

### 3. Configure your Tailwind config

Add the following to your `tailwind.config.js`:

```js
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

// Get safelist classes from file (generated by wp-tailwind-safelist)
const __dirname = path.dirname(fileURLToPath(import.meta.url));
const safelistFile = path.resolve(__dirname, 'tailwind-safelist.txt');
const safelistClasses = (() => {
  if (!fs.existsSync(safelistFile)) return [];
  const classesString = fs.readFileSync(safelistFile, 'utf8');
  if (!classesString) return [];
  const classesBuffer = Buffer.from(classesString, 'base64');
  return classesBuffer.toString().split(' ').filter(Boolean);
})();

/** @type {import('tailwindcss').Config} */
export default {
  // ... your config

  safelist: [
    // Dynamic classes from WordPress content
    ...safelistClasses,

    // Your other safelist entries...
  ],
}
```

### 4. Run the initial scan

```bash
wp acorn tailwind:scan
```

### 5. Rebuild your assets

```bash
yarn build
```

## Usage

### Scan all content

Scans all posts, pages, ACF fields, CF7 forms, widgets, and Blade templates:

```bash
wp acorn tailwind:scan
```

### Scan specific post types

```bash
wp acorn tailwind:scan --post-types=post --post-types=page
```

### Skip template scanning

```bash
wp acorn tailwind:scan --skip-templates
```

## How it works

### Automatic detection on save

When you save a post, page, or CF7 form in the WordPress admin, the plugin automatically:

1. Extracts all CSS classes from the content
2. Stores them in the database
3. Updates the `tailwind-safelist.txt` file

### Manual scanning

The `tailwind:scan` command provides a comprehensive scan of:

- **All post types** - Posts, pages, custom post types
- **Contact Form 7** - Form templates and mail templates
- **ACF Fields** - Including:
  - Flexible Content layouts
  - Repeater fields
  - Group fields
  - All nested fields
  - Fields with class-related names (automatically detected)
- **ACF Options Pages** - All registered options pages
- **Widgets** - All widget settings
- **Blade Templates** - All `.blade.php` files in `resources/views`

## Configuration

Publish the config file:

```bash
wp acorn vendor:publish --provider="CopiaDigital\TailwindSafelist\TailwindSafelistServiceProvider"
```

### Config options

```php
// config/tailwind-safelist.php

return [
    // Output file path
    'output_path' => get_stylesheet_directory() . '/tailwind-safelist.txt',

    // Patterns to exclude (regex)
    'exclude_patterns' => [
        '/^wp-/',      // WordPress classes
        '/^wpcf7/',    // Contact Form 7 classes
        // Add your own patterns...
    ],

    // Field names that contain CSS classes
    'class_field_patterns' => [
        'class',
        'classes',
        'custom_class',
        'tailwind',
        // Add your own patterns...
    ],
];
```

## License

MIT License - see [LICENSE](LICENSE) for details.
